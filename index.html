<html>
<head>
    <title>Twitch | Teams Page</title>
    <style>
    </style>

    <script type="text/javascript">
        if (document.location.hash && document.location.hash != '') {
            var parsedHash = new URLSearchParams(window.location.hash.substr(1));
            if (parsedHash.get('access_token')) {
                if (window.opener) {
                    window.opener.processToken(parsedHash.get('access_token'));
                    window.close();
                }
            }
        }

        if (document.location.search && document.location.search != '') {
            var parsedParams = new URLSearchParams(window.location.search);
            if (parsedParams.get('error_description')) {
                document.getElementById('status').classList.add('show');
                document.getElementById('status').textContent = 'Looks like you Tried to oAuth Authenticate and Somethibg went wrong: ' + parsedParams.get('error') + ' - ' + parsedParams.get('error_description');
            }
        }
    </script>
</head>
<body>

    <a href="" id="authorize" target="barrysgithubtwitchauth">Authorize</a>
    
    <div id="status">Pending</div>

    <script type="text/javascript">
        // go populate this with a client_id
        var client_id = 'jm9omolnvrbdhe7i9k774xys65k5ec';
        var redirect = 'dm16g12.github.io/';
        // setup a memory space for the token/userID
        var access_token = '';
        var user_id = '';
        let status = document.getElementById('status');

        // setuo authorise link
        document.getElementById('authorize').setAttribute('href', 'https://id.twitch.tv/oauth2/authorize?client_id=' + client_id + '&redirect_uri=' + encodeURIComponent(redirect) + '&response_type=token')

        function processToken(token) {
            access_token = token;

            status.textContent = 'Got Token. Loading Things';

            loadATeam('loadedllc');
        }

        function loadATeam(name) {
            let url = new URL('https://api.twitch.tv/helix/teams');
            let params = {
                name
            };

            url.search = new URLSearchParams(params).toString();

            fetch(
                url,
                {
                    "headers": {
                        "Client-ID": client_id,
                        "Authorization": "Bearer " + access_token
                    }
                }
            )
            .then(resp => resp.json())
        }

        // https://api.twitch.tv/helix/users/follows?to_id=23161357

        
        

        
    </script>
</body>
</html>
